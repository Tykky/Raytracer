language: cpp
os:
  - linux
  - windows
  - macos

before_install:
- |-
    case $TRAVIS_OS_NAME in 
    windows)
        choco install -y qtcreator
        set PATH=%PATH%;C:\tools\qtcreator\bin
        set PATH=%PATH%;C:\tools\qtcreator\bin\plugins\platforms
        ;;
    esac
    case $TRAVIS_OS_NAME in 
    linux)
      sudo apt-get update
      sudo apt-get install qt5-default
      ;;
    esac
    case $TRAVIS_OS_NAME in 
    macos)
      brew install qt5 cmake
    ;;
    esac

before_script:
        - mkdir build
        - cd build
        - cmake ..
script:
        - cmake --build .
        - ./Test/gtest_run

after_success:
         - bash <(curl -s https://codecov.io/bash)

before_deploy:
# Set up git user name and tag this commit
  - git config --local user.name "Tykky"
  - git config --local user.email "40919314+Tykky@users.noreply.github.com"
  - export RELEASE_NAME="$TRAVIS_OS_NAME $(git describe --tags)"

deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file:
    - ./Source/raytracer
    - ./Source/raytracer.exe
  skip_cleanup: true
  on:
    tags: true